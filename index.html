<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ¼«èµ„æºç´¢å¼•åº“</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background: #f4f4f9; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; min-height: 100vh; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
        .header { padding: 20px; border-bottom: 1px solid #eee; position: sticky; top: 0; background: #fff; z-index: 100; }
        h1 { margin: 0 0 10px 0; font-size: 1.5rem; text-align: center; }
        .status-bar { font-size: 12px; color: #888; text-align: center; margin-bottom: 10px; }
        
        /* æœç´¢æ¡†æ ·å¼ */
        .search-box { position: relative; }
        input { width: 100%; padding: 12px 15px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; background: #f9f9f9; transition: all 0.2s; }
        input:focus { border-color: #0088cc; background: #fff; box-shadow: 0 0 0 3px rgba(0,136,204,0.1); }

        /* åˆ—è¡¨æ ·å¼ */
        #list { padding: 0 20px; }
        .item { padding: 15px 0; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .info { overflow: hidden; margin-right: 15px; }
        .name { font-weight: 500; color: #333; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: 15px; }
        .meta { font-size: 12px; color: #999; }
        .btn { text-decoration: none; background: #0088cc; color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; white-space: nowrap; font-weight: 500; }
        .btn:active { transform: scale(0.95); }

        /* Loading é®ç½© */
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 1000; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #0088cc; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading">
        <div class="spinner"></div>
        <div id="loading-text">æ­£åœ¨ä¸‹è½½ç´¢å¼•æ•°æ®...</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“º åŠ¨æ¼«ç´¢å¼•</h1>
            <div class="status-bar" id="status">è¿æ¥æ•°æ®åº“ä¸­...</div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢åŠ¨æ¼« (ä¾‹å¦‚: è¿›å‡» 1080p)...">
            </div>
        </div>
        <div id="list"></div>
    </div>

    <script>
        let allVideos = [];
        const listEl = document.getElementById('list');
        const statusEl = document.getElementById('status');
        const loadingEl = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');

        // æ ¸å¿ƒï¼šå¼‚æ­¥è·å– JSON
        async function loadData() {
            try {
                // åŠ ä¸ªæ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜å¤ªæ­»ï¼Œä½†GitHub Pagesæœ¬èº«æœ‰ç¼“å­˜ç­–ç•¥
                const response = await fetch('data.json?v=' + new Date().getTime());
                
                if (!response.ok) throw new Error("ç½‘ç»œé”™è¯¯");

                // è·å–æ–‡ä»¶å¤§å°ç”¨äºæ˜¾ç¤ºè¿›åº¦ï¼ˆå¦‚æœæœåŠ¡å™¨æ”¯æŒ Content-Lengthï¼‰
                const contentLength = response.headers.get('content-length');
                const total = parseInt(contentLength, 10);
                let loaded = 0;

                const reader = response.body.getReader();
                const chunks = [];
                
                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    chunks.push(value);
                    loaded += value.length;
                    if(total) {
                        loadingText.innerText = `ä¸‹è½½ä¸­: ${Math.round(loaded / 1024 / 1024 * 10) / 10} MB`;
                    }
                }

                // ç»„è£… Blob å¹¶è§£æ JSON
                const blob = new Blob(chunks);
                const text = await blob.text();
                const json = JSON.parse(text);

                allVideos = json.videos;
                
                statusEl.innerText = `æœ€åæ›´æ–°: ${json.updated_at} | æ€»æ”¶å½•: ${json.total} æ¡`;
                loadingEl.style.display = 'none'; // éšè— loading
                
                // åˆå§‹æ¸²æŸ“å‰ 50 æ¡
                renderList(allVideos.slice(0, 50));

            } catch (error) {
                loadingText.innerText = "æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚";
                console.error(error);
            }
        }

        // æ¸²æŸ“åˆ—è¡¨ (åªæ¥å—è¦æ˜¾ç¤ºçš„æ•°æ®æ•°ç»„)
        function renderList(videos) {
            let html = '';
            videos.forEach(v => {
                html += `
                    <div class="item">
                        <div class="info">
                            <div class="name" title="${v.name}">${v.name}</div>
                            <div class="meta">${v.date} Â· ${v.size} MB</div>
                        </div>
                        <a href="${v.link}" target="_blank" class="btn">View</a>
                    </div>
                `;
            });
            listEl.innerHTML = html;
        }

        // æœç´¢å»æŠ–åŠ¨ (é˜²å¡é¡¿)
        let timeout = null;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                const keyword = e.target.value.toLowerCase().trim();
                
                if (!keyword) {
                    renderList(allVideos.slice(0, 50));
                    return;
                }

                // å¤šå…³é”®è¯æ”¯æŒ (ä¾‹å¦‚è¾“å…¥ "å·¨äºº 1080")
                const terms = keyword.split(' ');
                
                // ç­›é€‰é€»è¾‘
                const filtered = allVideos.filter(v => {
                    const name = v.name.toLowerCase();
                    return terms.every(term => name.includes(term));
                });

                // æ°¸è¿œåªæ¸²æŸ“å‰ 100 æ¡ç»“æœï¼Œé˜²æ­¢ DOM çˆ†ç‚¸
                // å¦‚æœç»“æœå¤ªå¤šï¼Œå°±åœ¨åº•éƒ¨æç¤º
                renderList(filtered.slice(0, 100));
                
                if (filtered.length === 0) {
                    listEl.innerHTML = '<div style="text-align:center; padding:20px; color:#999">æœªæ‰¾åˆ°ç›¸å…³èµ„æº</div>';
                }
            }, 300); // 300ms å»¶è¿Ÿ
        });

        // å¯åŠ¨
        loadData();
    </script>
</body>
</html>
